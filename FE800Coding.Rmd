---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

```{r LIBRARIES AND PACKAGES}
##  INSTALL REQUIRED PACKAGES AND LIBRARIES
install.packages("sm")
install.packages("ggplot2")
install.packages("sqldf")


##  INSTALL LIBRARIES
library(sm)
library(ggplot2)
library(sqldf)
```


```{r SET WORKING DIRECTORY}
getwd()
#setwd("C:/Users/harshil.b.shah/Documents/GitHub/FE800HBS")
#setwd("C:/Users/binta.d.patel/Documents/GitHub/FE800HBS/FE800HBS")
setwd("C:/Users/richa/OneDrive/Documents/Education/Stevens Institute/FE 800/Project/FE800HBS")

## read Donald Trump tweets downloaded from trumptwitterarchive.com 
realDT <- read.csv("DonaldTrumpTweets.csv",header = TRUE)

```

```{r}
## see first 6 rows of the dataset
head(realDT)

## tail(realDT)
```

```{r}
## check number of rows and columns
nrow(realDT)
ncol(realDT)
```

```{r}
## check date range of tweets
summary(realDT)
```

```{r LOAD STOCK DATA}
##  Read Stock Data
stockdata <- read.csv("stockdata.csv", header = TRUE, sep = ",")
##  Summarize Stock Data
head(stockdata)
##  Number of Rows in stock market data
nrow(stockdata)

```

```{r SUBSET STOCK DATA }
## CREATE SUBSETS OF THE STOCK DATA FOR DIFFERENT ANALYISS

overnight_ret_1_min <- subset(stockdata, overnight_1 == 1) ## select the subject of returns that are from close of business to opening of next business day
ret_1_min <- subset(stockdata, overnight_1 == 0) ## select the subset of 1 minute returns that are intraday
ret_2_min <- subset(stockdata, overnight_2 == 0) ## select the subset of 2 minute returns that are intraday
ret_5_min <- subset(stockdata, overnight_5 == 0) ## select the subset of 5 minute returns that are intraday
ret_10_min <- subset(stockdata, overnight_10 == 0) ## select the subset of 10 minute returns that are intraday
ret_20_min <- subset(stockdata, overnight_20 == 0) ## select the subset of 20 minute returns that are intraday
ret_30_min <- subset(stockdata, overnight_30 == 0) ## select the subset of 30 minute returns that are intraday
ret_60_min <- subset(stockdata, overnight_60 == 0) ## select the subset of 60 minute returns that are intraday
ret_120_min <- subset(stockdata, overnight_120 == 0) ## select the subset of 120 minute returns that are intraday
ret_240_min <- subset(stockdata, overnight_240 == 0) ## select the subset of 240 minute returns that are intraday
ret_360_min <- subset(stockdata, overnight_360 == 0) ## select the subset of 360 minute returns that are intraday

```

```{r STATISTICS}
##  Statistics about 1, 2, 5, 10, 20, 30, 60, 120, 240, and 360-minute returns
max1 <- max(ret_1_min$ret_1_min) #max return
min1 <- min(ret_1_min$ret_1_min) #min return
mean1 <- mean(ret_1_min$ret_1_min) #mean
sd1 <- sd(ret_1_min$ret_1_min) #standard deviation

max2 <- max(ret_2_min$ret_2_min) #max return
min2 <- min(ret_2_min$ret_2_min) #min return
mean2 <- mean(ret_2_min$ret_2_min) #mean
sd2 <- sd(ret_2_min$ret_2_min) #standard deviation

max5 <- max(ret_5_min$ret_5_min) #max return
min5 <- min(ret_5_min$ret_5_min) #min return
mean5 <- mean(ret_5_min$ret_5_min) #mean
sd5 <- sd(ret_5_min$ret_5_min) #standard deviation

max10 <- max(ret_10_min$ret_10_min) #max return
min10 <- min(ret_10_min$ret_10_min) #min return
mean10 <- mean(ret_10_min$ret_10_min) #mean
sd10 <- sd(ret_10_min$ret_10_min) #standard deviation

max20 <- max(ret_20_min$ret_20_min) #max return
min20 <- min(ret_20_min$ret_20_min) #min return
mean20 <- mean(ret_20_min$ret_20_min) #mean
sd20 <- sd(ret_20_min$ret_20_min) #standard deviation

max30 <- max(ret_30_min$ret_30_min) #max return
min30 <- min(ret_30_min$ret_30_min) #min return
mean30 <- mean(ret_30_min$ret_30_min) #mean
sd30 <- sd(ret_30_min$ret_30_min) #standard deviation

max60 <- max(ret_60_min$ret_60_min) #max return
min60 <- min(ret_60_min$ret_60_min) #min return
mean60 <- mean(ret_60_min$ret_60_min) #mean
sd60 <- sd(ret_60_min$ret_60_min) #standard deviation

max120 <- max(ret_120_min$ret_120_min) #max return
min120 <- min(ret_120_min$ret_120_min) #min return
mean120 <- mean(ret_120_min$ret_120_min) #mean
sd120 <- sd(ret_120_min$ret_120_min) #standard deviation

max240 <- max(ret_240_min$ret_240_min) #max return
min240 <- min(ret_240_min$ret_240_min) #min return
mean240 <- mean(ret_240_min$ret_240_min) #mean
sd240 <- sd(ret_240_min$ret_240_min) #standard deviation

max360 <- max(ret_360_min$ret_360_min) #max return
min360 <- min(ret_360_min$ret_360_min) #min return
mean360 <- mean(ret_360_min$ret_360_min) #mean
sd360 <- sd(ret_360_min$ret_360_min) #standard deviation

maxon <- max(overnight_ret_1_min$ret_1_min, na.rm=TRUE) #max return (excludes NA values)
minon <- min(overnight_ret_1_min$ret_1_min, na.rm=TRUE) #min return (excludes NA values)
meanon <- mean(overnight_ret_1_min$ret_1_min, na.rm=TRUE) #mean (excludes NA values)
sdon <- sd(overnight_ret_1_min$ret_1_min, na.rm=TRUE) #standard deviation (excludes NA values)


```

```{r SUMMARY TABLE WITH STATISTICS RESULTS}
##  Create Summary Table

sumtable <- matrix(c(max1, min1, mean1, sd1, max2, min2, mean2, sd2, max5, min5, mean5, sd5, max10, min10, mean10, sd10, max20, min20, mean20, sd20, max30, min30, mean30, sd30, max60, min60, mean60, sd60, max120, min120, mean120, sd120, max240, min240, mean240, sd240, max360, min360, mean360, sd360, maxon, minon, meanon, sdon), ncol = 4, byrow = TRUE)
colnames(sumtable) <- c("Max", "Min", "Mean", "Std. Dev")
rownames(sumtable) <- c("1 Minute", "2 Minutes", "5 Minutes", "10 Minutes", "20 Minutes", "30 Minutes", "60 Minutes", "120 Minutes", "240 Minutes", "360 Minutes", "Overnight")
sumtable <- as.table(sumtable)
sumtable
```




```{r DT TWEET STOCKDATA}
## CREATE SUBSETS OF THE STOCK DATA THAT REPRESENTS THE TIME FRAMES AFTER DONALD TRUMP TWEETS

dt_overnight_ret_1_min <- subset(stockdata, dttweetflag == 1 & overnight_1 == 1) ## select the subset of returns that are from close of business to opening of next business day
dt_ret_1_min <- subset(stockdata, dttweetflag == 1 & overnight_1 == 0) ## select the subset of 1 minute returns that are intraday
dt_ret_2_min <- subset(stockdata, dttweetflag == 1 & overnight_2 == 0) ## select the subset of 2 minute returns that are intraday
dt_ret_5_min <- subset(stockdata, dttweetflag == 1 & overnight_5 == 0) ## select the subset of 5 minute returns that are intraday
dt_ret_10_min <- subset(stockdata, dttweetflag == 1 & overnight_10 == 0) ## select the subset of 10 minute returns that are intraday
dt_ret_20_min <- subset(stockdata, dttweetflag == 1 & overnight_20 == 0) ## select the subset of 20 minute returns that are intraday
dt_ret_30_min <- subset(stockdata, dttweetflag == 1 & overnight_30 == 0) ## select the subset of 30 minute returns that are intraday
dt_ret_60_min <- subset(stockdata, dttweetflag == 1 & overnight_60 == 0) ## select the subset of 60 minute returns that are intraday
dt_ret_120_min <- subset(stockdata, dttweetflag == 1 & overnight_120 == 0) ## select the subset of 120 minute returns that are intraday
dt_ret_240_min <- subset(stockdata, dttweetflag == 1 & overnight_240 == 0) ## select the subset of 240 minute returns that are intraday
dt_ret_360_min <- subset(stockdata, dttweetflag == 1 & overnight_360 == 0) ## select the subset of 360 minute returns that are intraday
```

```{r STATISTICS DT}
##  Statistics about 1, 2, 5, 10, 20, 30, 60, 120, 240, and 360-minute returns
dt_max1 <- max(dt_ret_1_min$ret_1_min) #max return
dt_min1 <- min(dt_ret_1_min$ret_1_min) #min return
dt_mean1 <- mean(dt_ret_1_min$ret_1_min) #mean
dt_sd1 <- sd(dt_ret_1_min$ret_1_min) #standard deviation

dt_max2 <- max(dt_ret_2_min$ret_2_min) #max return
dt_min2 <- min(dt_ret_2_min$ret_2_min) #min return
dt_mean2 <- mean(dt_ret_2_min$ret_2_min) #mean
dt_sd2 <- sd(dt_ret_2_min$ret_2_min) #standard deviation

dt_max5 <- max(dt_ret_5_min$ret_5_min) #max return
dt_min5 <- min(dt_ret_5_min$ret_5_min) #min return
dt_mean5 <- mean(dt_ret_5_min$ret_5_min) #mean
dt_sd5 <- sd(dt_ret_5_min$ret_5_min) #standard deviation

dt_max10 <- max(dt_ret_10_min$ret_10_min) #max return
dt_min10 <- min(dt_ret_10_min$ret_10_min) #min return
dt_mean10 <- mean(dt_ret_10_min$ret_10_min) #mean
dt_sd10 <- sd(dt_ret_10_min$ret_10_min) #standard deviation

dt_max20 <- max(dt_ret_20_min$ret_20_min) #max return
dt_min20 <- min(dt_ret_20_min$ret_20_min) #min return
dt_mean20 <- mean(dt_ret_20_min$ret_20_min) #mean
dt_sd20 <- sd(dt_ret_20_min$ret_20_min) #standard deviation

dt_max30 <- max(dt_ret_30_min$ret_30_min) #max return
dt_min30 <- min(dt_ret_30_min$ret_30_min) #min return
dt_mean30 <- mean(dt_ret_30_min$ret_30_min) #mean
dt_sd30 <- sd(dt_ret_30_min$ret_30_min) #standard deviation

dt_max60 <- max(dt_ret_60_min$ret_60_min) #max return
dt_min60 <- min(dt_ret_60_min$ret_60_min) #min return
dt_mean60 <- mean(dt_ret_60_min$ret_60_min) #mean
dt_sd60 <- sd(dt_ret_60_min$ret_60_min) #standard deviation

dt_max120 <- max(dt_ret_120_min$ret_120_min) #max return
dt_min120 <- min(dt_ret_120_min$ret_120_min) #min return
dt_mean120 <- mean(dt_ret_120_min$ret_120_min) #mean
dt_sd120 <- sd(dt_ret_120_min$ret_120_min) #standard deviation

dt_max240 <- max(dt_ret_240_min$ret_240_min) #max return
dt_min240 <- min(dt_ret_240_min$ret_240_min) #min return
dt_mean240 <- mean(dt_ret_240_min$ret_240_min) #mean
dt_sd240 <- sd(dt_ret_240_min$ret_240_min) #standard deviation

dt_max360 <- max(dt_ret_360_min$ret_360_min) #max return
dt_min360 <- min(dt_ret_360_min$ret_360_min) #min return
dt_mean360 <- mean(dt_ret_360_min$ret_360_min) #mean
dt_sd360 <- sd(dt_ret_360_min$ret_360_min) #standard deviation

dt_maxon <- max(dt_overnight_ret_1_min$ret_1_min, na.rm=TRUE) #max return (excludes NA values)
dt_minon <- min(dt_overnight_ret_1_min$ret_1_min, na.rm=TRUE) #min return (excludes NA values)
dt_meanon <- mean(dt_overnight_ret_1_min$ret_1_min, na.rm=TRUE) #mean (excludes NA values)
dt_sdon <- sd(dt_overnight_ret_1_min$ret_1_min, na.rm=TRUE) #standard deviation (excludes NA values)


```

```{r SUMMARY TABLE WITH STATISTICS RESULTS DT}
##  Create Summary Table

dt_sumtable <- matrix(c(dt_max1, dt_min1, dt_mean1, dt_sd1, dt_max2, dt_min2, dt_mean2, dt_sd2, dt_max5, dt_min5, dt_mean5, dt_sd5, dt_max10, dt_min10, dt_mean10, dt_sd10, dt_max20, dt_min20, dt_mean20, dt_sd20, dt_max30, dt_min30, dt_mean30, dt_sd30, dt_max60, dt_min60, dt_mean60, dt_sd60, dt_max120, dt_min120, dt_mean120, dt_sd120, dt_max240, dt_min240, dt_mean240, dt_sd240, dt_max360, dt_min360, dt_mean360, dt_sd360, dt_maxon, dt_minon, dt_meanon, dt_sdon), ncol = 4, byrow = TRUE)
colnames(dt_sumtable) <- c("Max", "Min", "Mean", "Std. Dev")
rownames(dt_sumtable) <- c("1 Minute", "2 Minutes", "5 Minutes", "10 Minutes", "20 Minutes", "30 Minutes", "60 Minutes", "120 Minutes", "240 Minutes", "360 Minutes", "Overnight")
dt_sumtable <- as.table(dt_sumtable)
dt_sumtable
```



```{r HISTOGRAMS}

## HISTOGRAM OF MINUTE BY MINUTE STOCK RETURNS

hist(ret_1_min$ret_1_min, 
     breaks = 500,
     main = "1 Minute Intraday Returns",
     xlab = "Minute Level Returns", 
     col = "Light Blue")

##  HISTOGRAM OF OVERNIGHT STOCK RETURNS

hist(overnight_ret_1_min$ret_1_min, 
     breaks = 100,
     main = "Overnight Returns",
     xlab = "End of Trading Day to Beginning of Next Trading Day Returns", 
     col = "Red")

```

```{r DENSITY PLOTS}

##  CREATE DENSITY PLOT DISTRIBUTIONS

d1 <- density(ret_1_min$ret_1_min, from = -0.05, to = 0.05)
d2 <- density(ret_2_min$ret_2_min, from = -0.05, to = 0.05)
d5 <- density(ret_5_min$ret_5_min, from = -0.05, to = 0.05)
d10 <- density(ret_10_min$ret_10_min, from = -0.05, to = 0.05)
d20 <- density(ret_20_min$ret_20_min, from = -0.05, to = 0.05)
d30 <- density(ret_30_min$ret_30_min, from = -0.05, to = 0.05)
d60 <- density(ret_60_min$ret_60_min, from = -0.05, to = 0.05)
d120 <- density(ret_120_min$ret_120_min, from = -0.05, to = 0.05)
d240 <- density(ret_240_min$ret_240_min, from = -0.05, to = 0.05)
d360 <- density(ret_360_min$ret_360_min, from = -0.05, to = 0.05)
don <- density(overnight_ret_1_min$ret_1_min, na.rm = TRUE, from = -0.05, to = 0.05) #EXCLUDE NA VALUES FROM ANALYSIS (ERROR RESULTS IF YOU DON'T DO THIS)


##  PLOT DENSITY PLOTS

plot(d1, main = "Denstiy Plot: 1 Minute Returns", xlab = "Distribution of 1 Minute Returns") 
polygon(d1, col = "Light Blue", border = "Blue")
plot(d2, main = "Denstiy Plot: 2 Minute Returns", xlab = "Distribution of 2 Minute Returns")
polygon(d2, col = "Light Blue", border = "Blue")
plot(d5, main = "Denstiy Plot: 5 Minute Returns", xlab = "Distribution of 5 Minute Returns")
polygon(d5, col = "Light Blue", border = "Blue")
plot(d10, main = "Denstiy Plot: 10 Minute Returns", xlab = "Distribution of 10 Minute Returns")
polygon(d10, col = "Light Blue", border = "Blue")
plot(d20, main = "Denstiy Plot: 20 Minute Returns", xlab = "Distribution of 20 Minute Returns")
polygon(d20, col = "Light Blue", border = "Blue")
plot(d30, main = "Denstiy Plot: 30 Minute Returns", xlab = "Distribution of 30 Minute Returns")
polygon(d30, col = "Light Blue", border = "Blue")
plot(d60, main = "Denstiy Plot: 60 Minute Returns", xlab = "Distribution of 60 Minute Returns")
polygon(d60, col = "Light Blue", border = "Blue")
plot(d120, main = "Denstiy Plot: 120 Minute Returns", xlab = "Distribution of 120 Minute Returns")
polygon(d120, col = "Light Blue", border = "Blue")
plot(d240, main = "Denstiy Plot: 240 Minute Returns", xlab = "Distribution of 240 Minute Returns")
polygon(d240, col = "Light Blue", border = "Blue")
plot(d360, main = "Denstiy Plot: 360 Minute Returns", xlab = "Distribution of 360 Minute Returns")
polygon(d360, col = "Light Blue", border = "Blue")
plot(don, main = "Denstiy Plot: Overnight Returns", xlab = "Distribution of Overnight Returns")
polygon(don, col = "Light Green", border = "Green")

```

```{r}
## LOAD TRUMP TWEETS

dt <- read.csv("dt_tweets.csv", sep = ",", header = TRUE)
dt

```

```{r TRUMP TWEET DATA PROFILING}
##  DATA PROFILING USING SQLDF

##  Number of Tweets in the Data Set
sqldf("SELECT COUNT(*) FROM dt")

```

```{r COUNT OF TWEETS IN / OUT OF TRADING HOURS}

##  Number of Tweets During / Outside of Trading Hours
sqldf("SELECT DURINGTRADINGHOURS, COUNT(*)
      FROM dt
      GROUP BY 1")
```

```{r BAR PLOT OF TRUMPS TWEETS PER HOUR}


##  Number of Tweets Per Hour of the Day
DT1 <- sqldf('SELECT HOUR, COUNT(*) as numtweets 
      FROM dt 
      GROUP BY hour')

x <- 0:23 # NEEDED IN PLOT BELOW TO CREATE X AXIS

barplot(DT1$numtweets, 
        main = "Donald Trump Tweets by Hour of the Day",
        xlab = "Hour of the Day", 
        ylab = "Number of Tweets",
        col = "light blue",
        names.arg = c(x),
        cex.lab=1)
```

```{r}

## Number of Tweets by Year and Month
DT2 <- sqldf('SELECT YEAR, MONTH, DATE, COUNT(*) as numtweets
      FROM dt
      GROUP BY 1, 2, 3')

plot(DT2$numtweets,type = "l", 
     main = "Number of Tweets by Day", 
     xlab = "Day", 
     ylab = "Number of Tweets", 
     col = "Blue")

```

